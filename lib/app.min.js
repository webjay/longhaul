var Router,Savings,Snapshots,modalSavingDoneView,navView,photoItemView,productformView,savingModel,savingView,savingsModel,savingsView,snapshotModel,template,templates,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},__bind=function(fn,me){return function(){return fn.apply(me,arguments)}};snapshotModel=function(_super){function snapshotModel(){return snapshotModel.__super__.constructor.apply(this,arguments)}return __extends(snapshotModel,_super),snapshotModel}(Backbone.Model),savingsModel=function(_super){function savingsModel(){return savingsModel.__super__.constructor.apply(this,arguments)}return __extends(savingsModel,_super),savingsModel.prototype.defaults={total:0},savingsModel}(Backbone.Model),savingModel=function(_super){function savingModel(){return savingModel.__super__.constructor.apply(this,arguments)}return __extends(savingModel,_super),savingModel.prototype.defaults={photo:"http://farm9.staticflickr.com/8437/7985037130_00a14b4339_d.jpg"},savingModel.prototype.initialize=function(){return this.on("change:mediaFiles",function(event,data){return this.set("photo",data[0].fullPath)}),this.on("change:amount",function(event,data){var amount;return amount=parseInt(data,10),this.set("amount",amount||0)})},savingModel.prototype.validate=function(attrs){return""===$.trim(attrs.product)&&0===attrs.amount?"not valid":void 0},savingModel}(Backbone.Model),Snapshots=function(_super){function Snapshots(){return Snapshots.__super__.constructor.apply(this,arguments)}return __extends(Snapshots,_super),Snapshots.prototype.model=snapshotModel,Snapshots.prototype.initialize=function(){return $("#snaps .thumbnails").show(),this.on("add",function(){return function(model){var view;return view=new photoItemView({model:model}),$("#snaps .thumbnails").append(view.render().$el)}}(this))},Snapshots}(Backbone.Collection),Savings=function(_super){function Savings(){return this.initialize=__bind(this.initialize,this),Savings.__super__.constructor.apply(this,arguments)}return __extends(Savings,_super),Savings.prototype.model=savingModel,Savings.prototype.storage=new Offline.Storage("savings",Savings),Savings.prototype.savingsModel=new savingsModel,Savings.prototype.initialize=function(){return new savingsView({model:this.savingsModel}),this.on("add",function(_this){return function(model){var view;return model.isValid()?(model.get("sid")||model.save(),view=new savingView({model:model}),_this.savingsModel.set("total",_this.savingsModel.get("total")+model.get("amount"))):model.destroy()}}(this)),this.fetch({local:!0})},Savings.prototype.calcTotal=function(){var amounts;return amounts=this.pluck("amount"),amounts.reduce(function(previousValue,currentValue){return currentValue+previousValue},0)},Savings}(Backbone.Collection),templates={},template='<div class="thumbnail"><img src="<%= src %>" alt="Snapshot" /></div>',templates.snapshotView=_.template(template),template='<td><img src="<%= photo %>" class="img-circle" /></td><td><%- product %></td><td class="text-right"><%= amount %></td>',templates.savingView=_.template(template),template='<h3><%= cheer %></h3><p class="lead">Those <%= amount %> you just saved brings you to a total of <%= total %></p>',templates.modalSavingDone=_.template(template),navView=function(_super){function navView(){return navView.__super__.constructor.apply(this,arguments)}return __extends(navView,_super),navView.prototype.el="#mainnav",navView.prototype.events={'shown a[href="#saveup"]':function(){return $('#productform input[name="product"]').focus()}},navView}(Backbone.View),productformView=function(_super){function productformView(){return this.photoSuccess=__bind(this.photoSuccess,this),productformView.__super__.constructor.apply(this,arguments)}return __extends(productformView,_super),productformView.prototype.el="#productform",productformView.prototype.events={"click #savetoggle":"submit"},productformView.prototype.photoSuccess=function(mediaFiles){return this.model.set("mediaFiles",mediaFiles),new Snapshots(mediaFiles,{silent:!1})},productformView.prototype.photoFail=function(message){return console.error(message)},productformView.prototype.submit=function(event){var data,sd;return event.preventDefault(),sd=this.$el.serializeArray(),data=_(sd).reduce(function(acc,field){return acc[field.name]=field.value,acc},{}),this.model.set(data),this.collection.add(this.model),this.$el[0].reset(),$("#snaps .thumbnails").empty(),this.model=new savingModel,$("#modalSavingDone").modal()},productformView}(Backbone.View),photoItemView=function(_super){function photoItemView(){return this.render=__bind(this.render,this),photoItemView.__super__.constructor.apply(this,arguments)}return __extends(photoItemView,_super),photoItemView.prototype.tagName="li",photoItemView.prototype.render=function(){return this.$el.html(templates.snapshotView({src:this.model.get("fullPath")})),this},photoItemView}(Backbone.View),savingsView=function(_super){function savingsView(){return this.render=__bind(this.render,this),this.initialize=__bind(this.initialize,this),savingsView.__super__.constructor.apply(this,arguments)}return __extends(savingsView,_super),savingsView.prototype.el="#savings",savingsView.prototype.initialize=function(){return this.model.on("change",this.render)},savingsView.prototype.render=function(){var total;return total=this.model.get("total"),this.$("tfoot td:nth-child(2)").html(total),this},savingsView}(Backbone.View),savingView=function(_super){function savingView(){return this.render=__bind(this.render,this),savingView.__super__.constructor.apply(this,arguments)}return __extends(savingView,_super),savingView.prototype.tagName="tr",savingView.prototype.initialize=function(){return $("#savings tbody").append(this.render().$el)},savingView.prototype.render=function(){var attributes;return attributes=_.clone(this.model.attributes),attributes.amount=attributes.amount,this.$el.html(templates.savingView(attributes)),this},savingView}(Backbone.View),modalSavingDoneView=function(_super){function modalSavingDoneView(){return this.render=__bind(this.render,this),modalSavingDoneView.__super__.constructor.apply(this,arguments)}return __extends(modalSavingDoneView,_super),modalSavingDoneView.prototype.el="#modalSavingDone",modalSavingDoneView.prototype.events={show:"render"},modalSavingDoneView.prototype.cheers=["Awesome","Bravo","Brava","Excellent","Well done","Splendid","Marvellous","Magnificent","Brilliant"],modalSavingDoneView.prototype.cheer=function(){return this.cheers[Math.floor(Math.random()*this.cheers.length)]},modalSavingDoneView.prototype.render=function(){var attributes;return this.model=this.collection.at(this.collection.length-1),attributes={amount:this.model.get("amount"),total:this.collection.savingsModel.get("total"),cheer:this.cheer()},this.$(".modal-body").html(templates.modalSavingDone(attributes)),this},modalSavingDoneView}(Backbone.View),Router=function(_super){function Router(){return Router.__super__.constructor.apply(this,arguments)}return __extends(Router,_super),Router.prototype.routes={saveup:"saveup",savings:"savings","*path":"saveup"},Router.prototype.hideAll=function(){return $("#main section").hide()},Router.prototype.saveup=function(){return $("#saveup").tab("show")},Router.prototype.savings=function(){return $("#savings").tab("show")},Router}(Backbone.Router),jQuery(function($){var savings;return Backbone.$=$,new navView,savings=new Savings,new productformView({collection:savings,model:new savingModel}),new modalSavingDoneView({collection:savings})});