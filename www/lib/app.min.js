var Router,Savings,Snapshots,app,photoItemView,productformView,savingModel,savingView,savingsModel,savingsView,snapshotModel,template,templates,_ref,_ref1,_ref2,_ref3,_ref4,_ref5,_ref6,_ref7,_ref8,_ref9,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},__bind=function(fn,me){return function(){return fn.apply(me,arguments)}};app={},snapshotModel=function(_super){function snapshotModel(){return _ref=snapshotModel.__super__.constructor.apply(this,arguments)}return __extends(snapshotModel,_super),snapshotModel.prototype.defaults={fullPath:"http://farm9.staticflickr.com/8437/7985037130_00a14b4339_d.jpg"},snapshotModel}(Backbone.Model),savingsModel=function(_super){function savingsModel(){return _ref1=savingsModel.__super__.constructor.apply(this,arguments)}return __extends(savingsModel,_super),savingsModel}(Backbone.Model),savingModel=function(_super){function savingModel(){return _ref2=savingModel.__super__.constructor.apply(this,arguments)}return __extends(savingModel,_super),savingModel.prototype.defaults={product:"?",amount:0,photo:"http://farm9.staticflickr.com/8437/7985037130_00a14b4339_d.jpg"},savingModel.prototype.initialize=function(){return this.on("change:mediaFiles",function(event,data){return this.set("photo",data[0].fullPath)}),this.on("change:amount",function(event,data){var amount;return amount=parseInt(data,10),this.set("amount",amount||0)})},savingModel}(Backbone.Model),Snapshots=function(_super){function Snapshots(){return _ref3=Snapshots.__super__.constructor.apply(this,arguments)}return __extends(Snapshots,_super),Snapshots.prototype.model=snapshotModel,Snapshots.prototype.initialize=function(){return $("#snaps .thumbnails").show(),this.on("add",function(model){var view;return view=new photoItemView({model:model}),$("#snaps .thumbnails").append(view.render().$el)})},Snapshots}(Backbone.Collection),Savings=function(_super){function Savings(){return this.initialize=__bind(this.initialize,this),_ref4=Savings.__super__.constructor.apply(this,arguments)}return __extends(Savings,_super),Savings.prototype.model=savingModel,Savings.prototype.storage=new Offline.Storage("savings",Savings),Savings.prototype.initialize=function(){var _this=this;return this.savingsModel=new savingsModel,new savingsView({model:this.savingsModel}),this.on("add",function(model){var view;return model.save(),view=new savingView({model:model}),$("#savings tbody").append(view.render().$el),_this.savingsModel.set("total",_this.calcTotal())}),this.fetch({local:!0})},Savings.prototype.calcTotal=function(){return this.reduce(function(memo,value){return memo+value.get("amount")},0)},Savings}(Backbone.Collection),templates={},template='<div class="thumbnail"><img src="<%= src %>" alt="Snapshot" /></div>',templates.snapshotView=_.template(template),template='<td><img src="<%= photo %>" class="img-circle" /></td><td><%- product %></td><td class="text-right"><%= amount %></td>',templates.savingView=_.template(template),productformView=function(_super){function productformView(){return this.photoSuccess=__bind(this.photoSuccess,this),this.capturePhoto=__bind(this.capturePhoto,this),_ref5=productformView.__super__.constructor.apply(this,arguments)}return __extends(productformView,_super),productformView.prototype.el="#productform",productformView.prototype.events={"click #camtoggle":"capturePhoto","click #savetoggle":"submit"},productformView.prototype.capturePhoto=function(){var error;try{return navigator.device.capture.captureImage(this.photoSuccess,this.photoFail,{limit:1})}catch(_error){return error=_error,console.error(error)}},productformView.prototype.photoSuccess=function(mediaFiles){return this.model.set("mediaFiles",mediaFiles),new Snapshots(mediaFiles,{silent:!1})},productformView.prototype.photoFail=function(message){return console.error(message)},productformView.prototype.submit=function(event){var data,sd;return event.preventDefault(),sd=this.$el.serializeArray(),data=_(sd).reduce(function(acc,field){return acc[field.name]=field.value,acc},{}),this.model.set(data),this.collection.add(this.model),this.$el[0].reset(),$("#snaps .thumbnails").empty(),this.model=new savingModel},productformView}(Backbone.View),photoItemView=function(_super){function photoItemView(){return this.render=__bind(this.render,this),_ref6=photoItemView.__super__.constructor.apply(this,arguments)}return __extends(photoItemView,_super),photoItemView.prototype.tagName="li",photoItemView.prototype.render=function(){return this.$el.html(templates.snapshotView({src:this.model.get("fullPath")})),this},photoItemView}(Backbone.View),savingsView=function(_super){function savingsView(){return this.render=__bind(this.render,this),this.initialize=__bind(this.initialize,this),_ref7=savingsView.__super__.constructor.apply(this,arguments)}return __extends(savingsView,_super),savingsView.prototype.el="#savings",savingsView.prototype.initialize=function(){return this.model.on("change",this.render)},savingsView.prototype.render=function(){return this.$("tfoot td:nth-child(2)").html(this.model.get("total")),this},savingsView}(Backbone.View),savingView=function(_super){function savingView(){return this.render=__bind(this.render,this),_ref8=savingView.__super__.constructor.apply(this,arguments)}return __extends(savingView,_super),savingView.prototype.tagName="tr",savingView.prototype.render=function(){return this.$el.html(templates.savingView(this.model.attributes)),this},savingView}(Backbone.View),Router=function(_super){function Router(){return _ref9=Router.__super__.constructor.apply(this,arguments)}return __extends(Router,_super),Router.prototype.routes={saveup:"saveup",savings:"savings","*path":"saveup"},Router.prototype.hideAll=function(){return $("#main section").hide()},Router.prototype.saveup=function(){return this.hideAll(),$("#saveup").show()},Router.prototype.savings=function(){return this.hideAll(),$("#savings").show()},Router}(Backbone.Router),Zepto(function($){return Backbone.$=$,new productformView({collection:new Savings,model:new savingModel}),new Router,Backbone.history.start()});
//@ sourceMappingURL=www/lib/app.min.js.map